<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living and Non-living Things - Interactive Lesson</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /*------------------------------------*/
        /* 1. Global Styles & Variables      */
        /*------------------------------------*/
        :root {
            --primary-color: #2979FF; /* Blue */
            --secondary-color: #FFC107; /* Yellow */
            --accent-red: #D32F2F;    /* Red */
            --accent-green: #388E3C;   /* Green */
            --text-dark: #333;
            --text-light: #FEFEFE;
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --border-color: #dee2e6;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);

            --font-family-base: 'Poppins', sans-serif;
            --font-size-base: 16px;
            --font-size-h1: 2.2rem;
            --font-size-h2: 1.8rem;
            --font-size-h3: 1.4rem;
            --line-height-base: 1.7; /* Increased slightly for better spacing with icons */
            --border-radius: 8px;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
             scroll-behavior: smooth; /* Smooth scroll for jump-to-top */
        }

        body {
            font-family: var(--font-family-base);
            font-size: var(--font-size-base);
            line-height: var(--line-height-base);
            color: var(--text-dark);
            background-color: var(--bg-light);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
        }

        #lesson-container {
            background-color: var(--bg-white);
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px var(--shadow-medium);
            padding: 30px 40px;
            max-width: 800px;
            width: 100%;
            overflow: hidden; /* For animations */
            position: relative;
        }

        h1, h2, h3 {
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-color);
            line-height: 1.4; /* Adjusted line height */
            /* Allow inline flex for segment/button alignment - KEEP FOR HEADERS */
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
        }
        h1 { font-size: var(--font-size-h1); }
        h2 { font-size: var(--font-size-h2); margin-top: 1.5rem; }
        h3 { font-size: var(--font-size-h3); margin-top: 1rem; }

        /* --- CSS CHANGE --- */
        /* Changed p back to display: block to fix wrapping issue with trailing icons */
        p {
            margin-bottom: 0.8rem;
            color: var(--text-dark);
            display: block; /* Changed from inline-flex */
            /* Removed flex-wrap, align-items, width as they related to inline-flex */
        }


        ul {
            padding-left: 20px;
            margin-bottom: 1rem;
        }
        /* Style for li inside ul */
        ul li {
            /* display: list-item; */ /* Removing this to allow flex alignment below */
            margin-bottom: 0.8rem; /* Consistent spacing */
            color: var(--text-dark);
             margin-left: 5px; /* Indent text relative to bullet */
             /* If li needs internal flex alignment (like headers): */
              display: flex;
              flex-wrap: wrap;
              align-items: baseline;
              /* Removed width: 100% as list-item handles width */
        }


        strong {
            font-weight: 600;
        }

        /*------------------------------------*/
        /* 2. Layout & Section Styling     */
        /*------------------------------------*/
        .lesson-section {
            display: none; /* Hidden by default */
            animation: slideInFade 0.5s ease-out forwards;
            margin-bottom: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            min-height: 300px; /* Ensure sections have some min height */
        }
        .lesson-section.active {
            display: block;
        }
        .lesson-section:first-of-type { /* Welcome screen doesn't need top border */
             border-top: none;
             padding-top: 0;
             min-height: auto; /* Welcome section height can be auto */
        }

        @keyframes slideInFade {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /*------------------------------------*/
        /* 3. Buttons & Interactivity        */
        /*------------------------------------*/
        button {
            font-family: var(--font-family-base);
            font-size: 1rem;
            font-weight: 600;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
            margin: 5px; /* Default margin for standalone buttons */
            vertical-align: middle; /* Align buttons better */
            line-height: 1; /* Prevent extra height issues */
            background: none; /* Reset background for icon buttons */
            color: inherit; /* Inherit color for icon buttons */
        }

        /* Specific styles for main action/nav buttons */
        .btn-choice, .btn-nav {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 10px 20px; /* Re-apply padding */
            display: inline-flex; /* Use flex for internal alignment */
            align-items: center; /* Center items vertically */
            justify-content: center; /* Center items horizontally */
            gap: 8px; /* Space between text and icon container */
            margin: 5px; /* Keep margin for spacing between buttons */
            border: none; /* Ensure no border inherited */
        }
        .btn-nav { /* Nav buttons have secondary color */
             background-color: var(--secondary-color);
             color: var(--text-dark);
        }
        .btn-choice { /* Difficulty choice buttons */
            min-width: 150px;
            display: block; /* Stack the choice buttons */
            margin: 15px auto; /* Center the choice buttons */
        }


        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }


        .btn-choice:hover:not(:disabled),
        .btn-nav:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 8px var(--shadow-medium);
        }
         .btn-nav:hover:not(:disabled) { /* Slightly different hover for nav */
            transform: translateY(-2px);
            box-shadow: 0 3px 6px var(--shadow-light);
        }


        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
             flex-wrap: wrap; /* Allow wrapping on small screens */
        }


        #prev-button { visibility: hidden; /* Show via JS */ }

        /* Styles for icons embedded within buttons */
        .button-icons {
            display: inline-flex;
            align-items: center;
            gap: 0px; /* Minimal gap between icons */
            margin-left: 5px; /* Space icons slightly from text */
        }

        .embedded-icon {
            padding: 0 3px !important; /* Minimal padding, override general button padding */
            margin: 0 !important; /* No margin */
            font-size: 1.1rem; /* Icon size */
            line-height: 1; /* Ensure tight line height */
            background: none !important; /* No background */
            border: none !important; /* No border */
            color: inherit !important; /* Inherit color from parent button */
            vertical-align: middle; /* Align icon vertically */
            opacity: 0.8;
            transition: opacity 0.2s ease;
            cursor: pointer; /* Ensure cursor indicates clickability */
        }
        .embedded-icon:hover {
             opacity: 1;
             transform: none !important; /* Prevent inner icons from scaling */
             box-shadow: none !important; /* Prevent inner icons from having shadow */
        }


        /*------------------------------------*/
        /* 4. Quiz Styling                   */
        /*------------------------------------*/
        .quiz-container {
            background-color: #e3f2fd; /* Light blue background */
            padding: 20px;
            margin-top: 25px;
            margin-bottom: 25px;
            border-radius: var(--border-radius);
            border: 1px solid #bbdefb;
        }

        .quiz-block {
             margin-bottom: 20px;
             padding-bottom: 15px;
             border-bottom: 1px dashed var(--border-color);
        }
         .quiz-block:last-child {
             margin-bottom: 0;
             padding-bottom: 0;
             border-bottom: none;
         }

        .quiz-question {
            font-weight: 600;
            margin-bottom: 15px;
            display: inline-flex; /* Use flex for alignment */
            align-items: baseline;
            flex-wrap: wrap;
            width: 100%; /* Take full width */
        }

        .quiz-options {
            display: flex;
            flex-direction: column; /* Stack option groups vertically */
            gap: 15px; /* Space between option groups */
            margin-bottom: 10px;
        }

        .option-group {
            display: flex;
            align-items: center; /* Vertically center button and icons */
            gap: 5px; /* Space between option button and its icons */
        }

        /* Style the main quiz option button */
        .quiz-option-button {
            background-color: var(--bg-white);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            flex-grow: 1; /* Allow button to take available space */
            text-align: left; /* Align text left */
            padding: 8px 15px; /* Adjust padding */
            margin: 0; /* Reset margin */
            position: relative; /* For +1 effect */
            cursor: pointer; /* Explicitly set cursor for the button */
        }
        .quiz-option-button:hover:not(:disabled) {
            background-color: #e3f2fd;
            transform: scale(1.01); /* Smaller scale effect */
        }

        /* Style the TTS/Translate buttons associated with quiz options */
        .option-group .tts-button,
        .option-group .translate-button {
            padding: 5px !important; /* Smaller padding */
            font-size: 1rem; /* Adjust icon size */
            line-height: 1; /* Prevent extra height */
            flex-shrink: 0; /* Prevent icons from shrinking */
            margin: 0 !important; /* Reset margin */
            background: none !important;
            border: none !important;
            color: var(--primary-color) !important; /* Reset color */
            opacity: 0.7;
            cursor: pointer; /* Ensure cursor is pointer even after answer */
        }
         .option-group .tts-button:hover,
         .option-group .translate-button:hover {
             opacity: 1;
             transform: none !important;
             box-shadow: none !important;
         }

        /* Feedback styling - applies to the BUTTON ITSELF now */
         .quiz-option-button.correct {
            background-color: var(--accent-green) !important; /* Use important to override base */
            color: var(--text-light) !important;
            border-color: var(--accent-green) !important;
            animation: subtleBounceFeedback 0.5s ease;
        }

        .quiz-option-button.incorrect {
            background-color: var(--accent-red) !important;
            color: var(--text-light) !important;
            border-color: var(--accent-red) !important;
            animation: gentleShakeFeedback 0.5s ease;
        }

        .quiz-feedback {
            font-weight: 600;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            /* Use inline-flex for alignment of text and buttons */
             display: inline-flex;
             flex-wrap: wrap;
             align-items: baseline;
             width: auto; /* Adjust width based on content */
             line-height: 1.5; /* Ensure readable line height */
        }
        /* Hide feedback initially */
        .quiz-feedback:not(.correct):not(.incorrect) {
             display: none;
        }


        .quiz-feedback.correct {
            background-color: #e8f5e9; /* Light green */
            color: var(--accent-green);
             display: inline-flex; /* Ensure visible when class is added */
        }

        .quiz-feedback.incorrect {
            background-color: #ffebee; /* Light red */
            color: var(--accent-red);
            display: inline-flex; /* Ensure visible when class is added */
        }

        /* --- CSS FIX --- */
        /* Disable options after answering - style only the main button */
        .quiz-block.answered .option-group .quiz-option-button:disabled {
             opacity: 0.6;
             cursor: not-allowed;
        }
         /* Gray out unanswered options once answered */
         .quiz-block.answered .quiz-option-button:not(.correct):not(.incorrect):disabled {
             background-color: #eee !important; /* Important to override */
             border-color: #ccc !important;
             color: #888 !important;
             opacity: 0.7; /* Make them slightly more faded */
         }
         /* Keep feedback buttons usable */
          .quiz-feedback .tts-button,
          .quiz-feedback .translate-button {
              opacity: 0.7;
              cursor: pointer;
              /* Removed disabled attribute modification, control via JS/CSS opacity/cursor */
          }
           .quiz-feedback .tts-button:hover,
           .quiz-feedback .translate-button:hover {
                opacity: 1;
           }

         /* Prevent hover effect on disabled main answer buttons */
         .quiz-block.answered .option-group .quiz-option-button:hover:disabled {
             transform: none; /* Prevent hover effect on answered questions */
             box-shadow: none;
         }
         /* Ensure TTS/Translate remain hoverable visually even if block answered */
         .quiz-block.answered .option-group .tts-button:hover,
         .quiz-block.answered .option-group .translate-button:hover {
             opacity: 1;
             transform: none !important;
             box-shadow: none !important;
         }


        @keyframes subtleBounceFeedback {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes gentleShakeFeedback {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /*------------------------------------*/
        /* 5. Gamification & Effects         */
        /*------------------------------------*/
        .plus-one-effect {
            position: absolute;
            top: -25px; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-green);
            opacity: 0;
            animation: floatUpFade 0.8s ease-out forwards;
            pointer-events: none; /* Prevent interaction */
            z-index: 10; /* Ensure visibility */
        }

        @keyframes floatUpFade {
            0% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -30px); }
        }

        #final-score-display { /* Renamed from #final-score for clarity */
            font-weight: bold;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        #results-message {
            margin-top: 1rem;
            margin-bottom: 1.5rem; /* Add space before high scores */
        }

        /* --- High Score Styles --- */
        #high-score-board {
            margin-top: 30px;
            padding: 20px;
            background-color: #e3f2fd; /* Light blue like quiz */
            border-radius: var(--border-radius);
            border: 1px solid #bbdefb;
        }
        #high-score-board h3 {
             margin-top: 0; /* Remove extra top margin */
             text-align: center;
             color: var(--primary-color);
        }
        #high-score-list {
            list-style-type: none; /* Remove default bullets */
            padding: 0;
            margin-top: 15px;
            max-height: 250px; /* Limit height and make scrollable */
            overflow-y: auto; /* Add scroll if needed */
        }
        #high-score-list li {
            display: flex; /* Use flex for alignment */
            justify-content: space-between; /* Space out elements */
            padding: 8px 10px;
            border-bottom: 1px dashed var(--border-color);
            font-size: 0.95rem;
            align-items: center; /* Align items vertically */
             margin-left: 0; /* Reset indent from global li style */
             flex-wrap: nowrap; /* Prevent wrapping inside the score line */
        }
        #high-score-list li:last-child {
             border-bottom: none;
        }
        #high-score-list li .rank {
             font-weight: 700;
             min-width: 25px; /* Ensure rank alignment */
             color: var(--primary-color);
             margin-right: 10px;
        }
         #high-score-list li .emoji {
             margin-right: 10px;
             font-size: 1.1rem;
        }
        #high-score-list li .name {
             flex-grow: 1; /* Allow name to take up space */
             margin-right: 10px; /* Space before score */
             overflow: hidden; /* Prevent long names breaking layout */
             text-overflow: ellipsis;
             white-space: nowrap;
             text-align: left;
        }
        #high-score-list li .score {
             font-weight: 600;
             color: var(--accent-green);
             min-width: 60px; /* Ensure score alignment */
             text-align: right;
        }
        #high-score-list .no-scores { /* Style for the 'no scores' message */
             text-align: center;
             font-style: italic;
             color: #666;
             padding: 15px;
             border-bottom: none; /* Remove border for this item */
        }

        /*------------------------------------*/
        /* 6. ELL Scaffolding (TTS/Translate)*/
        /*------------------------------------*/
        .translatable-segment {
             display: inline; /* Keep inline within the flow */
             margin-right: 5px; /* Space before adjacent buttons */
             line-height: inherit; /* Inherit line height from parent */
             vertical-align: baseline; /* Ensure alignment */
        }

        /* General TTS/Translate buttons (NOT embedded in nav/action buttons or quiz options) */
        /* This applies to buttons directly after spans in <p>, <h2> etc. */
        .tts-button, .translate-button {
            background: none;
            border: none;
            padding: 0 2px; /* Minimal padding */
            margin: 0 2px;  /* Minimal margin */
            font-size: 1.1rem;
            cursor: pointer;
            vertical-align: baseline; /* Align with text baseline */
            color: var(--primary-color);
            opacity: 0.7;
            transition: opacity 0.2s ease;
            line-height: 1; /* Prevent extra height */
            display: inline-block; /* Ensure it stays inline */
        }
        .tts-button:hover, .translate-button:hover {
            opacity: 1;
        }

        /* Word highlighting */
        .highlight {
            background-color: var(--secondary-color);
            color: var(--text-dark);
            border-radius: 3px;
            padding: 0 2px;
            box-shadow: 0 0 0 1px var(--secondary-color);
            /* Smooth transition for highlighting */
            transition: background-color 0.1s ease-in-out;
        }


        .tts-controls {
            margin-bottom: 20px; /* Space below controls */
            padding: 10px;
            background-color: #eee;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .tts-controls label {
             font-size: 0.9rem;
             font-weight: 600;
             margin-right: 5px;
        }
        .tts-controls input[type="range"] {
             cursor: pointer;
             flex-grow: 1;
             max-width: 200px;
             vertical-align: middle;
        }
        #stop-tts-button {
            background-color: var(--accent-red); /* Specific background */
            color: var(--text-light); /* Specific color */
            font-size: 1rem; /* Adjusted size */
            padding: 5px 10px; /* Specific padding */
             margin-left: auto; /* Push stop button to the right if space allows */
        }
        #stop-tts-button:hover {
             opacity: 0.9;
             background-color: var(--accent-red); /* Maintain color on hover */
        }

        /*------------------------------------*/
        /* 7. Icons & Emojis                 */
        /*------------------------------------*/
        [aria-hidden="true"] {
             font-style: normal; /* Prevent italicization if parent is italic */
             display: inline-block; /* Ensure consistent spacing */
             margin: 0 2px; /* Add slight spacing around emojis */
        }

        /*------------------------------------*/
        /* 8. Responsive Design              */
        /*------------------------------------*/
        @media (max-width: 768px) {
            body { padding: 10px; }
            #lesson-container { padding: 20px; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.5rem; }
            h3 { font-size: 1.2rem; }
            button { font-size: 0.9rem; /* Base button size */ }
             .btn-choice, .btn-nav { padding: 8px 15px; } /* Adjust padding for main buttons */
             .embedded-icon { font-size: 1rem; } /* Slightly smaller embedded icons */

            /* Quiz options already column, adjust option group */
             .option-group { flex-wrap: wrap; } /* Allow icons to wrap below button if needed */
             .quiz-option-button { flex-basis: 100%; } /* Make button take full width */
            .navigation-buttons { flex-direction: column; gap: 10px; }
            .btn-nav { width: 100%; }
            #prev-button { order: 2; }
            #next-button { order: 1; }
            .tts-controls { gap: 10px;}
            #stop-tts-button { margin-left: 0; } /* Remove auto margin */

            /* High score responsiveness */
            #high-score-list li { font-size: 0.9rem; }
            #high-score-list li .name { margin-right: 5px; }
            #high-score-list li .score { min-width: 50px; }
        }

        @media (max-width: 480px) {
            #lesson-container { padding: 15px; }
             h1 { font-size: 1.6rem; }
            h2 { font-size: 1.3rem; }
             h3 { font-size: 1.1rem; }
            body { font-size: 15px; }
            .tts-controls { flex-direction: column; align-items: stretch;}
             .tts-controls input[type="range"] { max-width: none; }
             .btn-choice, .btn-nav { gap: 5px; } /* Reduce gap on small screens */
             .embedded-icon { font-size: 0.9rem; }

            /* High score responsiveness */
             #high-score-list li { padding: 6px 8px; }
             #high-score-list li .rank { min-width: 20px; margin-right: 5px;}
             #high-score-list li .emoji { margin-right: 5px; font-size: 1rem; }
        }

    </style>
</head>
<body>

    <div id="lesson-container">

        <!-- TTS Controls -->
        <div class="tts-controls">
            <label for="tts-speed">Reading Speed:</label>
            <input type="range" id="tts-speed" min="0.5" max="2" step="0.1" value="1">
            <button id="stop-tts-button" aria-label="Stop Reading">⏹️ Stop</button>
        </div>

        <!-- Section 0: Welcome & Difficulty Choice -->
        <div class="lesson-section active" id="section-0">
             <h1><span class="translatable-segment" data-easy="<span aria-hidden='true'>👋</span> Welcome to the Living Things Lesson!" data-challenge="<span aria-hidden='true'>👋</span> Welcome to the Living Things Lesson!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h1>
             <p><span class="translatable-segment" data-easy="Choose how you want to learn today." data-challenge="Choose how you want to learn today."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <div style="text-align: center; margin-top: 20px;"> <!-- Center buttons -->
                <button class="btn-choice" onclick="startLesson('easy')">Easy English</button>
                <button class="btn-choice" onclick="startLesson('challenge')">Challenge English</button>
            </div>
        </div>

        <!-- Section 1: Introduction -->
        <div class="lesson-section" id="section-1">
            <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>🌱</span> What is a Living Thing?" data-challenge="<span aria-hidden='true'>🌱</span> What is a Living Thing?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Look around! Some things are alive, like plants and animals. <span aria-hidden='true'>🐶🌳</span>" data-challenge="Look around you! You see toys, rocks, trees, pets, and people. Some of these things are living, and some are non-living."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Some things are not alive, like toys and rocks. <span aria-hidden='true'>🧸🧱</span>" data-challenge="But what makes something alive? A living thing is special because it can do certain things all by itself that non-living things (like a toy car or a stone) cannot do."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Living things can do special things! Non-living things cannot. Let's learn!" data-challenge="Let's learn about these special abilities!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Is a flower living?" data-challenge="Which of these is a living thing?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group" data-correct="true"> <!-- Correct: Tree -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="A tree"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="A cloud"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="A pencil"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 2 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Is your chair living?" data-challenge="Which of these is a non-living thing?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="A fish"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="A worm"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Bicycle -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="A bicycle"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 3 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Is a bird living?" data-challenge="Living things are different from non-living things because they can...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Change color"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Do special things -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Do special things"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Be hard"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 2: Characteristic 1 - Growth & Change -->
        <div class="lesson-section" id="section-2">
            <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>⬆️</span> Living Things Grow and Change" data-challenge="<span aria-hidden='true'>⬆️</span> They Grow and Change"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Living things start small and get bigger. This is called 'growing'." data-challenge="Living things don't stay the same size forever! They start small and get bigger (growth)."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Example: A baby kitten grows into a big cat. <span aria-hidden='true'>🐱</span>" data-challenge="Think about how a tiny baby grows into a child, or a small seed grows into a big plant."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="Example: A small seed grows into a tall plant. <span aria-hidden='true'>🌱</span>" data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p> <!-- Empty challenge segment, hide P -->
            <p><span class="translatable-segment" data-easy="Living things also change. Like a tadpole changing into a frog! <span aria-hidden='true'>🐸</span>" data-challenge="They also change as they grow, like a caterpillar changing into a butterfly (metamorphosis)!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What does 'grow' mean?" data-challenge="Which describes growth?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Stay same" data-challenge="Breaking apart"></span></button>
                             <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Increasing in size -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Get bigger" data-challenge="Increasing in size"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Get smaller" data-challenge="Changing location"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Which one shows growing?" data-challenge="What is an example of change in a living thing?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="A toy car staying same" data-challenge="A glass breaking"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="A river flowing"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Boy becoming teenager -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="A puppy getting bigger" data-challenge="A boy becoming a teenager"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="A caterpillar changing to a butterfly is an example of...?" data-challenge="Does a non-living thing like a teddy bear grow on its own?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Sleeping" data-challenge="Yes"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: No -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Changing" data-challenge="No"></span></button> <!-- Note: Correct answer maps Easy->Changing, Challenge->No -->
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 4 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Do rocks grow like plants?" data-challenge="The process of a seed becoming a large tree involves...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Only Growth"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Only Change"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Growth and Change -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Growth and Change"></span></button> <!-- Note: Correct answer maps Easy->No, Challenge->Growth and Change -->
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 3: Characteristic 2 - Movement -->
        <div class="lesson-section" id="section-3">
            <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>➡️</span> Living Things Can Move" data-challenge="<span aria-hidden='true'>➡️</span> They Can Move"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Most living things move. Animals walk, fly, or swim. <span aria-hidden='true'>🚶‍♀️🐦🐠</span>" data-challenge="Most living things can move in some way. Animals walk, swim, or fly to find food or escape danger."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="They move to find food or stay safe." data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p> <!-- Empty challenge -->
            <p><span class="translatable-segment" data-easy="Plants move too, but very slowly!" data-challenge="Even plants move, but very slowly! Their roots grow down into the soil, and their leaves and stems often grow towards the sunlight (phototropism). So, yes, even plants show movement!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="Plant roots grow down. Plant leaves grow towards the sun. <span aria-hidden='true'>☀️</span>" data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p> <!-- Empty challenge -->

             <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Can animals move?" data-challenge="Which is a way animals move?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Rolling"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Flying -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Flying"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Melting"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Why do animals move?" data-challenge="Plant movement is usually...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="To sleep all day" data-challenge="Very fast"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Non-existent"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Very slow -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="To find food" data-challenge="Very slow"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Do plants move?" data-challenge="A car moves, but is it living? Why?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No, never" data-challenge="Yes, it moves fast"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: No, it needs driver/fuel -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes, slowly" data-challenge="No, it needs a driver/fuel"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 4 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Which way do plant leaves often grow?" data-challenge="Growing towards sunlight is a type of movement shown by...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Towards dark" data-challenge="Rocks"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Clouds"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Plants -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Towards light" data-challenge="Plants"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 4: Characteristic 3 - Responding -->
        <div class="lesson-section" id="section-4">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>❗</span> Living Things Respond" data-challenge="<span aria-hidden='true'>❗</span> They Respond to Their Surroundings"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Living things notice and react to things around them. This is 'responding'." data-challenge="Living things notice what's happening around them (stimuli) and react (response)!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Example: If you touch a hot stove, you pull your hand back fast! <span aria-hidden='true'>🔥✋</span>" data-challenge="If you touch something hot (stimulus), you pull your hand away quickly (response)."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="Example: A sleepy cat wakes up if it hears a loud noise. <span aria-hidden='true'>🔊🐱</span>" data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Example: A plant grows towards the light. That's responding!" data-challenge="If a plant doesn't get enough light (stimulus), it might grow towards a window (response). This reacting or responding is a kind of change based on the environment."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                 <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What does 'respond' mean?" data-challenge="What is a stimulus?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="To sleep" data-challenge="The reaction itself"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Something that causes a reaction -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="To react" data-challenge="Something that causes a reaction"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="To eat" data-challenge="A type of food"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Pulling your hand from heat is...?" data-challenge="What is a response?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Growing" data-challenge="The stimulus itself"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="A type of movement"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: The reaction to a stimulus -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Responding" data-challenge="The reaction to a stimulus"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 3 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="A plant growing to light is...?" data-challenge="Which is an example of responding?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Moving Fast" data-challenge="A stone sitting still"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: A deer running from noise -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Responding" data-challenge="A deer running from a noise"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="A cloud changing shape"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 4 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Does a toy respond if you talk to it?" data-challenge="If a robot moves when you press a button, is that the same as a living thing responding?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Yes, it reacts"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: No, it's programmed -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="No, it's programmed"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 5: Characteristic 4 - Reproducing -->
        <div class="lesson-section" id="section-5">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>❤️</span> Living Things Make More (Babies!)" data-challenge="<span aria-hidden='true'>❤️</span> They Make More Like Themselves (Reproduce)"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Living things can make babies like themselves." data-challenge="Living things can make babies, or offspring, that are like them."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="This is called 'reproducing'." data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Example: Cats have kittens. <span aria-hidden='true'>🐈➡️🐱</span> Dogs have puppies. <span aria-hidden='true'>🐕➡️🐕</span>" data-challenge="Cats have kittens, dogs have puppies, birds lay eggs that hatch into chicks, and plants produce seeds that can grow into new plants."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p> <!-- FIXED EMOJIS - Corrected Dog Emoji -->
            <p><span class="translatable-segment" data-easy="Example: Plants make seeds. Seeds grow into new plants. <span aria-hidden='true'>🌻➡️🌱➡️🌻</span>" data-challenge="This essential process is called reproduction. It ensures life continues."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p> <!-- FIXED EMOJIS -->

             <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What does 'reproduce' mean?" data-challenge="What is another word for babies of living things?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Grow tall" data-challenge="Parents"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Move fast" data-challenge="Stimuli"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Offspring -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Make babies" data-challenge="Offspring"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What do cats have?" data-challenge="Reproduction is important because it...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Puppies" data-challenge="Helps things grow"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Continues life -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Kittens" data-challenge="Continues life"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Seeds" data-challenge="Allows movement"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What do plants make to reproduce?" data-challenge="Which is an example of reproduction?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Leaves" data-challenge="A tree getting taller"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Rocks" data-challenge="A dog running"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Bird laying egg -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Seeds" data-challenge="A bird laying an egg"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 4 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Can a toy car reproduce?" data-challenge="Do non-living things reproduce?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Yes, sometimes"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Only if they are new"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: No -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="No"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

         <!-- Section 6: What is a Non-living Thing? -->
        <div class="lesson-section" id="section-6">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>🧱</span> What is a Non-living Thing?" data-challenge="<span aria-hidden='true'>🧱</span> Defining Non-living Things"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Non-living things are things that are NOT alive." data-challenge="In contrast to living organisms, non-living things do not possess or exhibit the characteristics of life."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="They do <strong>not</strong> grow, move on their own, respond, reproduce, or need energy like living things." data-challenge="They do <strong>not</strong> grow biologically, move independently, respond to stimuli in a biological way, reproduce, or require energy intake for life processes."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="Examples: A rock <span aria-hidden='true'>🪨</span>, a toy car <span aria-hidden='true'>🏎️</span>, water <span aria-hidden='true'>💧</span>, a cloud <span aria-hidden='true'>☁️</span>." data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Some are found in nature (like rocks), some are made by people (like toys)." data-challenge="Non-living things can be <strong>natural</strong> (formed by natural processes, e.g., rocks, water, air, mountains) or <strong>man-made</strong> (created by humans, e.g., chairs, computers, clothes)."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                <!-- Quiz 1 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Is a pencil living or non-living?" data-challenge="Which item lacks the basic characteristics of life?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Living" data-challenge="A bacterium"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="A mushroom"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Stone -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Non-living" data-challenge="A stone"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Does a teddy bear grow like a kitten?" data-challenge="A mountain is an example of a...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Living thing"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Man-made non-living thing"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Natural non-living -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Natural non-living thing"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Which is natural non-living?" data-challenge="A robot can move and use power, but it's non-living because it cannot...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="A bicycle" data-challenge="Be programmed"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Reproduce or grow biologically -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="A river" data-challenge="Reproduce or grow biologically"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Be repaired"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 4 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Which is man-made non-living?" data-challenge="Classify a plastic bottle."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="A cloud" data-challenge="Living"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Natural non-living"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Man-made non-living -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="A book" data-challenge="Man-made non-living"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

         <!-- Section 7: Needs Intro & Food -->
         <div class="lesson-section" id="section-7">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>❓</span> What Do Living Things Need?" data-challenge="<span aria-hidden='true'>❓</span> Requirements for Life: Basic Needs"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Living things have <strong>needs</strong> to stay alive! Let's learn about them." data-challenge="Beyond their characteristics, all living organisms have fundamental <strong>needs</strong> that must be met to survive."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>🍎</span> Need 1: Food (Energy)" data-challenge="<span aria-hidden='true'>🍎</span> Need 1: Food/Nutrients (Energy Source)"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Living things need energy to live, grow, and move." data-challenge="Energy is required for all life processes."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Animals get energy from eating food. <span aria-hidden='true'>😋🍔</span>" data-challenge="Animals (consumers) obtain energy by eating other organisms."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Plants make their own food using sun <span aria-hidden='true'>☀️</span>, water <span aria-hidden='true'>💧</span>, and air <span aria-hidden='true'>💨</span>." data-challenge="Plants (producers) create their own food (glucose) through photosynthesis, using sunlight, water, and carbon dioxide."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

             <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Do living things need things to survive?" data-challenge="The primary role of food for living things is to provide...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Color"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Shelter"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Energy -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Energy"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="How do animals get energy?" data-challenge="An organism that makes its own food is called a...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Sleeping" data-challenge="Consumer"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Producer -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Eating food" data-challenge="Producer"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Decomposer"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="How do plants get energy?" data-challenge="Photosynthesis requires sunlight, water, and...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Eating dirt" data-challenge="Oxygen"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Nitrogen"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Carbon Dioxide -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Make own food" data-challenge="Carbon Dioxide"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 4 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What gives plants energy to make food?" data-challenge="Why doesn't a non-living rock need food?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Moonlight" data-challenge="It eats secretly"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Doesn't perform life processes -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Sunlight" data-challenge="It doesn't perform life processes"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="It gets energy from the ground"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 8: Need 2 - Water -->
        <div class="lesson-section" id="section-8">
            <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>💧</span> Need 2: Water" data-challenge="<span aria-hidden='true'>💧</span> Need 2: Water"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="All living things need water!" data-challenge="Water is essential for life. It makes up a large part of cells and organisms."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Animals drink water. Plants soak up water with their roots. <span aria-hidden='true'>🌱</span>" data-challenge="It's needed for many biological processes, including transporting nutrients, regulating temperature, and photosynthesis in plants."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Water helps bodies work right and helps plants make food." data-challenge="Organisms get water by drinking, absorbing it, or from their food."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Do plants need water?" data-challenge="Water is crucial for processes like nutrient transport and...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Growing taller instantly"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Changing color"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Temperature regulation -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Temperature regulation"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="How do most animals get water?" data-challenge="Besides drinking, how else might an animal obtain water?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Eating rocks" data-challenge="By breathing air"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: From food -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Drinking" data-challenge="From the food it eats"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="By sitting in the sun"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Water helps living things...?" data-challenge="Plants primarily absorb water through their...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Fly faster" data-challenge="Leaves"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Roots -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Stay alive" data-challenge="Roots"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Flowers"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 9: Need 3 - Air (Gases) -->
        <div class="lesson-section" id="section-9">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>💨</span> Need 3: Air" data-challenge="<span aria-hidden='true'>💨</span> Need 3: Air (Essential Gases)"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Most living things need air." data-challenge="Air contains gases vital for life."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Animals breathe in air to get oxygen <span aria-hidden='true'>😮‍💨</span>. We need oxygen to live!" data-challenge="Most animals and plants need <strong>oxygen</strong> for respiration (releasing energy from food)."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Plants use a gas from the air called carbon dioxide to make food. They also need oxygen!" data-challenge="Plants also need <strong>carbon dioxide</strong> from the air for photosynthesis (making food)."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

             <div class="quiz-container">
                <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What do animals breathe from the air?" data-challenge="The process where organisms use oxygen to release energy from food is called...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Carbon Dioxide" data-challenge="Photosynthesis"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Reproduction"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Respiration -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Oxygen" data-challenge="Respiration"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Do plants need air?" data-challenge="Plants use which gas from the air to make food?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="No" data-challenge="Oxygen"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Nitrogen"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Carbon Dioxide -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Yes" data-challenge="Carbon Dioxide"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="We need air to...?" data-challenge="True or False: Plants need both oxygen and carbon dioxide."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Fly" data-challenge="False"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: True -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Breathe and live" data-challenge="True"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 10: Need 4 - Habitat / Shelter -->
        <div class="lesson-section" id="section-10">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>🏠</span> Need 4: A Place to Live (Habitat & Shelter)" data-challenge="<span aria-hidden='true'>🏠</span> Need 4: Suitable Habitat & Shelter"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Living things need a place to live, called a <strong>habitat</strong>. It's their home! <span aria-hidden='true'>🌳🏞️🌊</span>" data-challenge="A <strong>habitat</strong> is the natural environment where an organism lives, providing necessary resources like food, water, and appropriate conditions."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p data-easy-only><span class="translatable-segment" data-easy="A habitat gives them the food, water, and air they need." data-challenge=""></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Many living things also need <strong>shelter</strong> (like a nest <span aria-hidden='true'>🐦</span> or cave <span aria-hidden='true'>🦇</span>) to stay safe from weather or danger." data-challenge="Within a habitat, many organisms require <strong>shelter</strong> – a specific place offering protection from predators, harsh weather, or a safe space for raising young. Examples include burrows, nests, dens, or even tree hollows."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                 <!-- Quiz 1 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What is a living thing's home called?" data-challenge="Which best describes a habitat?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Hat" data-challenge="Any place an animal visits"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Environment providing resources -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Habitat" data-challenge="An environment providing necessary resources"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Only the shelter"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                 <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="What does shelter do?" data-challenge="Shelter primarily provides...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Makes food" data-challenge="Food source"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Water source"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Protection -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Keeps safe" data-challenge="Protection"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="A bird's nest is an example of...?" data-challenge="A fish lives in a pond. The pond is its...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Food" data-challenge="Shelter only"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-challenge-only>
                             <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Food source"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-correct="true"> <!-- Correct: Habitat -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Shelter" data-challenge="Habitat"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 11: Summary & Final Check -->
        <div class="lesson-section" id="section-11">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>👍</span> All Together Now!" data-challenge="<span aria-hidden='true'>✔️</span> Summary: Characteristics & Needs"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
            <p><span class="translatable-segment" data-easy="Remember! Living things: Grow, Move, Respond, Reproduce." data-challenge="To be classified as living, an organism typically exhibits characteristics like growth, movement, response, and reproduction."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Living things NEED: Food (Energy), Water, Air, Habitat/Shelter." data-challenge="Furthermore, all living things require essential resources (needs) for survival: energy (from food/nutrients), water, appropriate gases (like oxygen/carbon dioxide), and a suitable habitat often including shelter."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>
            <p><span class="translatable-segment" data-easy="Non-living things cannot do these things and don't have these needs." data-challenge="Non-living things lack these characteristics and needs."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></p>

            <div class="quiz-container">
                <!-- Quiz 1 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Which is a NEED of living things?" data-challenge="Which set includes only NEEDS of most living things?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Standing Still" data-challenge="Growth, Movement, Shelter"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Energy, Water, Gases -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Water" data-challenge="Energy, Water, Gases"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Being Quiet" data-challenge="Reproduction, Response, Habitat"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 2 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Which is a CHARACTERISTIC of living things?" data-challenge="A core difference between a living bear and a non-living teddy bear is the living bear's ability to...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Being made of plastic" data-challenge="Be soft and cuddly"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Not needing air" data-challenge="Be found in a store"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Reproduce and respond -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Growing" data-challenge="Reproduce and respond biologically"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 3 Block -->
                 <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="Is a cloud living or non-living? Why?" data-challenge="Both plants and animals need ______ for respiration."></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Living | It moves" data-challenge="Carbon Dioxide"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Oxygen -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Non-living | It doesn't reproduce or need food" data-challenge="Oxygen"></span></button> <!-- Pipe separator for Easy -->
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group" data-challenge-only>
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-challenge="Sunlight"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
                <!-- Quiz 4 Block -->
                <div class="quiz-block">
                    <div class="quiz-question"><span class="translatable-segment" data-easy="A plant needs sunlight to...?" data-challenge="A desert provides the necessary resources for a cactus, making it the cactus's...?"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></div>
                    <div class="quiz-options">
                        <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Drink water" data-challenge="Shelter only"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                         <div class="option-group">
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Sleep" data-challenge="Energy source"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                        <div class="option-group" data-correct="true"> <!-- Correct: Habitat -->
                            <button class="quiz-option-button" onclick="handleQuizAnswer(this)"><span class="translatable-segment" data-easy="Make food" data-challenge="Habitat"></span></button>
                            <button class="tts-button" onclick="speakText(this)" aria-label="Read option aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate option">🌐</button>
                        </div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Section 12: Results -->
         <div class="lesson-section" id="section-12">
             <h2><span class="translatable-segment" data-easy="<span aria-hidden='true'>🏆</span> Lesson Complete!" data-challenge="<span aria-hidden='true'>🏆</span> Lesson Complete!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button></h2>
             <p>
                <span class="translatable-segment" data-easy="Your final score is:" data-challenge="Your final score is:"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button>
                <span id="final-score-display">0</span> / <span id="total-questions-display">0</span> <!-- Updated IDs, total will be set dynamically -->
            </p>
            <p id="results-message">
                <span class="translatable-segment" data-easy="Great job learning about living and non-living things and what they need!" data-challenge="Great job learning about living and non-living things and what they need!"></span><button class="tts-button" onclick="speakText(this)" aria-label="Read aloud">🔊</button><button class="translate-button" onclick="translateSegment(this)" aria-label="Translate">🌐</button>
            </p>

             <!-- High Score Board Added Here -->
             <div id="high-score-board">
                 <h3>🏆 High Scores 🏆</h3>
                 <ol id="high-score-list">
                     <li class="no-scores">Loading scores...</li>
                 </ol>
             </div>

            <div style="margin-top: 20px; text-align:center;"> <!-- Centered buttons -->
                 <!-- Play Again Button -->
                <button class="btn-nav btn-with-icons" onclick="window.location.reload();">
                    <span class="translatable-segment" data-easy="Play Again?" data-challenge="Play Again?">Play Again?</span>
                    <span class="button-icons">
                        <button class="tts-button embedded-icon" onclick="event.stopPropagation(); speakText(this.closest('.btn-with-icons'));" aria-label="Read button text">🔊</button>
                        <button class="translate-button embedded-icon" onclick="event.stopPropagation(); translateSegment(this.closest('.btn-with-icons'));" aria-label="Translate button text">🌐</button>
                    </span>
                </button>
                <!-- <button class="btn-nav" onclick="alert('Link to main menu')">Choose Another Lesson</button> -->
            </div>
        </div>


        <!-- Navigation Buttons -->
        <div class="navigation-buttons">
             <button id="prev-button" class="btn-nav" onclick="goPrevious()" disabled>
                 <span class="translatable-segment" data-easy="Previous" data-challenge="Previous">Previous</span>
             </button>
             <button id="next-button" class="btn-nav" onclick="goNext()" disabled> <!-- Onclick might be changed dynamically -->
                 <span class="translatable-segment" data-easy="Next" data-challenge="Next">Next</span>
             </button>
        </div>

    </div> <!-- End #lesson-container -->

    <script>
        //------------------------------------//
        //  Global Variables                 //
        //------------------------------------//
        let currentDifficulty = 'easy';
        let currentSectionIndex = 0;
        const sections = document.querySelectorAll('.lesson-section');
        const totalSections = sections.length;
        let currentScore = 0;
        let currentGameTotalQuestions = 0; // Dynamic total questions for current difficulty
        let perfectRun = true; // Flag for high score emoji
        let quizStates = Array(totalSections).fill(true); // Default to true (unless quiz exists)

        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const finalScoreDisplay = document.getElementById('final-score-display'); // Updated ID
        const totalQuestionsDisplay = document.getElementById('total-questions-display');
        const ttsSpeedSlider = document.getElementById('tts-speed');
        const stopTtsButton = document.getElementById('stop-tts-button');

        const synth = window.speechSynthesis;
        let currentUtterance = null;
        let highlightedWordSpan = null;
        let targetSegmentForHighlighting = null;

        const TRANSLATE_WINDOW_NAME = 'googleTranslateWindow';

        // --- High Score Variables ---
        const HIGH_SCORE_KEY = 'livingNonlivingHighScores_v1';
        const MAX_HIGH_SCORES = 10;

        //------------------------------------//
        //  Helper Functions                 //
        //------------------------------------//

        /**
         * Finds the primary text segment associated with a button click.
         * @param {HTMLElement} buttonOrContainer The button element that was clicked, OR a container element (like nav button).
         * @returns {HTMLElement | null} The associated translatable segment element or null.
         */
        function findAssociatedSegment(buttonOrContainer) {
             let segment = null;
             const parentElement = buttonOrContainer.parentElement;

             // Case 1: Button is embedded icon within a specific container type
             if (buttonOrContainer.classList.contains('embedded-icon')) {
                 const potentialParentContainer = buttonOrContainer.closest('.btn-with-icons, .option-group, .quiz-feedback');
                 if (potentialParentContainer) {
                     segment = potentialParentContainer.querySelector('.translatable-segment');
                      if (!segment && potentialParentContainer.classList.contains('option-group')) {
                          segment = potentialParentContainer.querySelector('.quiz-option-button .translatable-segment');
                      }
                 }
             }
             // Case 2: Button is *directly* inside a quiz option group (TTS/Translate next to answer)
             else if (buttonOrContainer.closest('.option-group') && (buttonOrContainer.classList.contains('tts-button') || buttonOrContainer.classList.contains('translate-button'))) {
                 segment = buttonOrContainer.closest('.option-group').querySelector('.quiz-option-button .translatable-segment');
             }
             // Case 3: Button is directly inside quiz feedback
             else if (buttonOrContainer.closest('.quiz-feedback')) {
                 segment = buttonOrContainer.closest('.quiz-feedback').querySelector('.translatable-segment');
             }
             // Case 4: Button is likely adjacent to segment within a common parent container (e.g., in <p>, <h1>, <li>)
             else if (parentElement && (parentElement.tagName.match(/^H[1-6]$/) || parentElement.tagName === 'P' || parentElement.tagName === 'LI' || parentElement.classList.contains('quiz-question'))) {
                 segment = parentElement.querySelector('.translatable-segment');
             }
             // Case 5: Button *is* the main nav/action button itself
             else if (buttonOrContainer.classList.contains('btn-with-icons') || buttonOrContainer.classList.contains('btn-nav')) {
                  segment = buttonOrContainer.querySelector('.translatable-segment');
             }
             // Fallback/General Case: Check previous sibling
             else if (buttonOrContainer.previousElementSibling?.classList.contains('translatable-segment')) {
                 segment = buttonOrContainer.previousElementSibling;
             }

             if (!segment && !(buttonOrContainer.classList.contains('btn-choice'))) { // Don't warn for difficulty choice buttons
                 console.warn("Could not find associated segment for:", buttonOrContainer);
             }
             return segment;
         }


        /**
         * Gets text content from a segment element, excluding content within aria-hidden elements.
         * @param {HTMLElement} segmentElement The segment element itself.
         * @returns {string} The cleaned text content.
         */
        function getTextForSpeech(segmentElement) {
            if (!segmentElement) return '';
            try {
                 // Special handling for the pipe separator in the summary quiz's "Easy" option
                 if (segmentElement.closest('.quiz-block') && segmentElement.closest('.lesson-section')?.id === 'section-11' && segmentElement.closest('.option-group')?.dataset.correct === 'true' && currentDifficulty === 'easy' && segmentElement.textContent.includes('|')) {
                      return segmentElement.textContent.split('|')[0].trim();
                 }

                const clone = segmentElement.cloneNode(true);
                clone.querySelectorAll('[aria-hidden="true"]').forEach(hiddenEl => hiddenEl.remove());
                clone.querySelectorAll('button').forEach(btn => btn.remove()); // Remove buttons too
                return clone.textContent.trim();
            } catch (e) {
                console.error("Error getting text for speech:", e);
                return segmentElement.textContent.trim(); // Fallback
            }
        }

        // Utility to escape regex special characters
        function escapeRegExp(string) {
          return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        /**
         * Shuffles array elements in place using Fisher-Yates algorithm.
         * @param {Array} array The array to shuffle.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
        }

        /**
         * Basic HTML sanitization for display.
         * @param {string} str Input string.
         * @returns {string} Sanitized string.
         */
         function sanitizeHTML(str) {
             if (!str) return "";
             return str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
         }


        //------------------------------------//
        //  Initialization                   //
        //------------------------------------//
        function startLesson(difficulty) {
            currentDifficulty = difficulty;
            initLesson();
            showSection(1); // Start at the first content section (index 1)
        }

        // --- MODIFIED initLesson Function ---
        function initLesson() {
            // --- High Score Reset ---
            perfectRun = true; // Reset perfect run flag

            // --- Visual Reset for Quizzes (Do this FIRST) ---
            document.querySelectorAll('.quiz-block.answered').forEach(qb => qb.classList.remove('answered'));
            document.querySelectorAll('.option-group').forEach(group => {
                const btn = group.querySelector('.quiz-option-button');
                const ttsBtn = group.querySelector('.tts-button');
                const transBtn = group.querySelector('.translate-button');

                // Enable ALL buttons initially during reset and clear styles
                if (btn) {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'incorrect');
                }
                if (ttsBtn) ttsBtn.disabled = false;
                if (transBtn) transBtn.disabled = false;
            });
            document.querySelectorAll('.quiz-feedback').forEach(fb => {
                fb.style.display = 'none'; // Hide feedback area
                fb.classList.remove('correct', 'incorrect');
                fb.innerHTML = ''; // Clear feedback text
            });

            // --- Calculate Dynamic Total Questions & Populate Text ---
            currentGameTotalQuestions = 0; // Reset count
            // Select a broader range of elements that might need text/visibility updates
            const elementsToProcess = document.querySelectorAll('[data-easy], [data-challenge], .option-group, .quiz-block, p[data-easy-only], p[data-challenge-only], li[data-easy-only], li[data-challenge-only]');

            elementsToProcess.forEach(el => {
                const isOptionGroup = el.classList.contains('option-group');
                const isQuizBlock = el.classList.contains('quiz-block');
                const isParagraph = el.tagName === 'P';
                const isListItem = el.tagName === 'LI';

                let targetSpan = null;
                // Find the correct span for text replacement if applicable
                 if (el.classList.contains('translatable-segment')) {
                     targetSpan = el; // Element itself is the segment (e.g., in headers)
                 } else if (isOptionGroup) {
                     const buttonSpan = el.querySelector('.quiz-option-button .translatable-segment');
                     if (buttonSpan) targetSpan = buttonSpan;
                 } else if (el.classList.contains('btn-nav') || el.classList.contains('btn-with-icons')) {
                      targetSpan = el.querySelector('.translatable-segment');
                  } else if (el.tagName.match(/^H[1-6]$/) || isParagraph || isListItem || el.classList.contains('quiz-question')) {
                      // General case for p, h*, li, quiz questions etc. containing a segment
                      targetSpan = el.querySelector('.translatable-segment');
                  }


                // Set text content if applicable
                if (el.dataset.easy !== undefined || el.dataset.challenge !== undefined) {
                     const easyText = el.dataset.easy;
                     const challengeText = el.dataset.challenge;
                     const textToSet = currentDifficulty === 'easy' ? easyText : challengeText;

                     if (targetSpan) {
                        // Only set if text is defined, not null, and not empty string for the current difficulty
                        if (textToSet !== undefined && textToSet !== null && textToSet !== '') {
                             targetSpan.innerHTML = textToSet; // Use innerHTML to render emojis/spans within text
                        } else {
                            // If the text for the current difficulty IS empty or missing, clear the span
                             targetSpan.innerHTML = '';
                        }
                     }
                 }

                // Determine visibility based on difficulty attributes
                let shouldBeVisible = true;
                 if (el.hasAttribute('data-easy-only') && currentDifficulty !== 'easy') {
                     shouldBeVisible = false;
                 } else if (el.hasAttribute('data-challenge-only') && currentDifficulty !== 'challenge') {
                     shouldBeVisible = false;
                 }
                 // Special handling for <p> tags that ONLY have easy text (and empty challenge text)
                  if (isParagraph && currentDifficulty === 'challenge' && el.dataset.challenge === '' && el.dataset.easy !== '') {
                      shouldBeVisible = false;
                  }

                 // Set display style based on visibility
                 let defaultDisplay = 'block'; // Default for p, div, quiz-block etc.
                 if (el.tagName.match(/^H[1-6]$/) || isOptionGroup || el.classList.contains('btn-nav') || el.classList.contains('btn-with-icons') || el.classList.contains('quiz-question') || isListItem) {
                     defaultDisplay = 'flex'; // Default for flex containers (headers, options, nav)
                     if (el.classList.contains('quiz-question')) defaultDisplay = 'inline-flex'; // Specific flex type
                     if (el.classList.contains('btn-nav') || el.classList.contains('btn-with-icons')) defaultDisplay = 'inline-flex'; // Specific flex type
                     if (isParagraph) defaultDisplay = 'block'; // Paragraphs revert to block
                 }


                 el.style.display = shouldBeVisible ? defaultDisplay : 'none';


                 // If an option group or quiz block is hidden based on difficulty, disable its buttons
                 if ((isOptionGroup || isQuizBlock) && !shouldBeVisible) {
                     el.querySelectorAll('.quiz-option-button, .tts-button, .translate-button').forEach(button => {
                         if (button) button.disabled = true;
                     });
                 }
                 // Ensure buttons within VISIBLE groups/blocks are enabled (redundant due to initial reset, but safe)
                 else if ((isOptionGroup || isQuizBlock) && shouldBeVisible) {
                     el.querySelectorAll('.quiz-option-button, .tts-button, .translate-button').forEach(button => {
                         if (button) button.disabled = false;
                     });
                 }

                 // --- Count Visible Questions ---
                 // Increment count only if it's a quiz block that is VISIBLE
                 // AND it contains at least one option group that is VISIBLE
                 if (isQuizBlock && shouldBeVisible) {
                      let blockHasVisibleOptions = false;
                      el.querySelectorAll('.option-group').forEach(group => {
                           let optionShouldBeVisible = true;
                            if (group.hasAttribute('data-easy-only') && currentDifficulty !== 'easy') {
                                optionShouldBeVisible = false;
                            } else if (group.hasAttribute('data-challenge-only') && currentDifficulty !== 'challenge') {
                                optionShouldBeVisible = false;
                            }
                            if (optionShouldBeVisible) {
                                blockHasVisibleOptions = true;
                                // Ensure buttons in visible options are enabled (double check)
                                group.querySelectorAll('.quiz-option-button, .tts-button, .translate-button').forEach(button => {
                                     if (button) button.disabled = false;
                                 });
                            } else {
                                // Ensure buttons in hidden options are disabled
                                group.querySelectorAll('.quiz-option-button, .tts-button, .translate-button').forEach(button => {
                                     if (button) button.disabled = true;
                                 });
                            }
                      });
                      if (blockHasVisibleOptions) {
                           currentGameTotalQuestions++;
                      } else {
                           // If block is visible but has NO visible options, hide the block too? Optional, but cleaner.
                           // el.style.display = 'none';
                      }
                 }
            });

            console.log("Recalculated Total Questions for " + currentDifficulty + ":", currentGameTotalQuestions);
            totalQuestionsDisplay.textContent = currentGameTotalQuestions; // Update display

             // --- Shuffle Quiz Answers for Challenge Mode (Only visible options) ---
             if (currentDifficulty === 'challenge') {
                 document.querySelectorAll('.quiz-block').forEach(quizBlock => {
                     // Check if block itself is determined to be visible by style
                     if (quizBlock.style.display !== 'none') {
                         const optionsContainer = quizBlock.querySelector('.quiz-options');
                         if (optionsContainer) {
                             // Filter based on style.display set earlier
                             const visibleOptionGroups = Array.from(optionsContainer.querySelectorAll('.option-group'))
                                                          .filter(og => og.style.display !== 'none');
                             if (visibleOptionGroups.length > 1) {
                                 shuffleArray(visibleOptionGroups);
                                 // Re-append shuffled visible groups
                                 visibleOptionGroups.forEach(group => optionsContainer.appendChild(group));
                             }
                         }
                     }
                 });
             }

            // --- Reset Quiz Completion States ---
            quizStates = Array(totalSections).fill(false); // Reset to incomplete initially
            sections.forEach((section, index) => {
                 if (index === 0 || index === totalSections - 1) { // Welcome/Results have no quiz
                     quizStates[index] = true; return;
                 }

                 const quizContainer = section.querySelector('.quiz-container');
                 let sectionHasVisibleQuizzes = false;
                  if (quizContainer) {
                      quizContainer.querySelectorAll('.quiz-block').forEach(block => {
                           // Check if block is styled as visible
                           if (block.style.display !== 'none') {
                               // Check if block has any options styled as visible
                                let blockHasVisibleOptions = false;
                                block.querySelectorAll('.option-group').forEach(optGroup => {
                                    if (optGroup.style.display !== 'none') {
                                         blockHasVisibleOptions = true;
                                    }
                                });
                                if (blockHasVisibleOptions) {
                                     sectionHasVisibleQuizzes = true;
                                }
                           }
                      });
                  }
                 // Mark section as complete (true) only if it has NO visible quizzes
                 quizStates[index] = !sectionHasVisibleQuizzes;
             });


            // --- Reset Score ---
            currentScore = 0;
            finalScoreDisplay.textContent = currentScore;


             // --- Reset Nav Button Text ---
             const nextButtonTextSpan = nextButton.querySelector('.translatable-segment');
             const prevButtonTextSpan = prevButton.querySelector('.translatable-segment');
             const nextText = nextButton.dataset[currentDifficulty] || 'Next';
             const prevText = prevButton.dataset[currentDifficulty] || 'Previous';
             if (nextButtonTextSpan) nextButtonTextSpan.textContent = nextText;
             if (prevButtonTextSpan) prevButtonTextSpan.textContent = prevText;

             // Set initial nav button state after init (important for first section)
             updateNavigation(); // Call helper to set button states based on index and quizStates
        }


        //------------------------------------//
        //  Navigation                       //
        //------------------------------------//
         function updateNavigation() {
             const isFirstSection = currentSectionIndex <= 0;
             const isLastSection = currentSectionIndex >= totalSections - 1;
             const isPenultimateSection = currentSectionIndex === totalSections - 2;

             // Previous Button
             prevButton.disabled = isFirstSection;
             prevButton.style.visibility = isFirstSection ? 'hidden' : 'visible';

             // Next Button Logic
             if (isLastSection) { // Results page
                 nextButton.style.visibility = 'hidden'; // Hide next
             } else if (isFirstSection) { // Welcome page
                 nextButton.style.visibility = 'hidden'; // Hide next
             } else { // Content pages
                 nextButton.style.visibility = 'visible'; // Show next
                 const nextButtonTextSpan = nextButton.querySelector('.translatable-segment');
                 const baseNextText = nextButton.dataset[currentDifficulty] || 'Next';

                 if (isPenultimateSection) {
                      if(nextButtonTextSpan) nextButtonTextSpan.textContent = "Finish";
                      nextButton.onclick = triggerFinishLesson; // Action: Finish
                 } else {
                      if(nextButtonTextSpan) nextButtonTextSpan.textContent = baseNextText;
                      nextButton.onclick = goNext; // Action: Go to next section
                 }
                 // Disable based on quiz completion state for the current section
                 nextButton.disabled = !quizStates[currentSectionIndex];
             }
         }

        function showSection(index) {
            if (index < 0 || index >= totalSections) return;

            stopSpeech(); // Stop any ongoing speech

            if (sections[currentSectionIndex]) {
                 sections[currentSectionIndex].classList.remove('active');
            }

            currentSectionIndex = index;
             if (sections[currentSectionIndex]) {
                  sections[currentSectionIndex].classList.add('active');
             } else {
                 console.error("Section index out of bounds:", index);
                 return;
             }

            // Update navigation buttons based on the new section index and its quiz state
            updateNavigation();

            // If it's the results section, update scores and display high scores
            if (currentSectionIndex === totalSections - 1) {
                 finalScoreDisplay.textContent = currentScore;
                 totalQuestionsDisplay.textContent = currentGameTotalQuestions;
                 displayHighScores();
            }

            document.getElementById('lesson-container').scrollTo({ top: 0, behavior: 'smooth' });
        }

        function goNext() {
             if (quizStates[currentSectionIndex] && currentSectionIndex < totalSections - 1) {
                 showSection(currentSectionIndex + 1);
             } else if (!quizStates[currentSectionIndex]) {
                 // Shake animation if quizzes aren't complete
                 nextButton.animate([
                    { transform: 'translateX(0)' }, { transform: 'translateX(-5px)' },
                    { transform: 'translateX(5px)' }, { transform: 'translateX(0)' }
                 ], { duration: 300, easing: 'ease-in-out' });
             }
        }

        function goPrevious() {
            showSection(currentSectionIndex - 1);
        }

         // --- New function to handle finishing the lesson ---
         function triggerFinishLesson() {
             // Ensure current section's quizzes are done (should be if button is enabled, but double check)
             if (!quizStates[currentSectionIndex]) {
                  console.warn("Attempted to finish lesson before completing quizzes.");
                  goNext(); // Call goNext to trigger the shake animation if needed
                  return;
             }

             const playerName = prompt("Lesson complete! Enter your name for the high score list:", "Learner") || "Anonymous Learner";
             saveHighScore(playerName, currentScore, perfectRun);
             // Note: displayHighScores() will be called when showSection navigates to the results page.
             // Now, navigate to the final section
             showSection(totalSections - 1);
         }

        //------------------------------------//
        //  Quiz Logic                       //
        //------------------------------------//

        // --- Helper function to add TTS/Translate buttons to feedback (to avoid repetition) ---
        function addFeedbackButtons(feedbackDiv) {
             if (!feedbackDiv || feedbackDiv.querySelector('.tts-button')) return; // Don't add if they already exist

              const segmentInFeedback = feedbackDiv.querySelector('.translatable-segment');
              if (segmentInFeedback) {
                 const ttsBtn = document.createElement('button');
                 ttsBtn.className = 'tts-button';
                 ttsBtn.innerHTML = '🔊';
                 ttsBtn.setAttribute('aria-label', 'Read feedback');
                 ttsBtn.onclick = () => speakText(ttsBtn); // Use the button itself
                 ttsBtn.disabled = false; // Ensure feedback buttons are usable
                 feedbackDiv.appendChild(ttsBtn);

                 const transBtn = document.createElement('button');
                 transBtn.className = 'translate-button';
                 transBtn.innerHTML = '🌐';
                 transBtn.setAttribute('aria-label', 'Translate feedback');
                 transBtn.onclick = () => translateSegment(transBtn); // Use the button itself
                 transBtn.disabled = false; // Ensure feedback buttons are usable
                 feedbackDiv.appendChild(transBtn);
              }
        }


        // --- MODIFIED handleQuizAnswer Function ---
        function handleQuizAnswer(buttonElement) {
             const optionGroup = buttonElement.closest('.option-group');
             const quizBlock = buttonElement.closest('.quiz-block');
             // Ensure the button clicked IS the main option button, not an icon inside it or next to it
             if (!buttonElement.classList.contains('quiz-option-button') || !quizBlock || quizBlock.classList.contains('answered') || !optionGroup) {
                 // console.log("Ignoring click or already answered."); // Optional debug
                 return; // Exit if not main button, already answered, or elements not found
             }

             stopSpeech(); // Stop TTS if it was reading something

             quizBlock.classList.add('answered');
             const feedbackDiv = quizBlock.querySelector('.quiz-feedback');
             const allOptionGroupsInBlock = quizBlock.querySelectorAll('.option-group');

             // --- Disable only the main answer buttons after an answer is chosen ---
             allOptionGroupsInBlock.forEach(group => {
                 const mainOptionButton = group.querySelector('.quiz-option-button');
                 if (mainOptionButton) {
                     mainOptionButton.disabled = true; // CORRECT: Only disable main button
                 }
                 // TTS and Translate buttons in the group remain enabled/disabled based on initLesson
             });

             const isCorrect = optionGroup.dataset.correct === 'true';

             if (isCorrect) {
                 buttonElement.classList.add('correct');
                 if (feedbackDiv) { // Check if feedbackDiv exists
                     feedbackDiv.classList.add('correct');
                     feedbackDiv.classList.remove('incorrect');
                     const correctFeedbackText = currentDifficulty === 'easy' ? "Correct! Good job!" : "Correct! Excellent!";
                     // Store both versions in data attributes for potential translation later
                     feedbackDiv.innerHTML = `<span class="translatable-segment" data-easy="Correct! Good job!" data-challenge="Correct! Excellent!">${correctFeedbackText}</span>`;
                     addFeedbackButtons(feedbackDiv); // Add TTS/Translate to feedback
                     feedbackDiv.style.display = 'inline-flex'; // Show feedback area
                 }
                 currentScore++;
                 triggerPlusOne(buttonElement);
             } else {
                 buttonElement.classList.add('incorrect');
                 if (feedbackDiv) { // Check if feedbackDiv exists
                    feedbackDiv.classList.add('incorrect');
                    feedbackDiv.classList.remove('correct');
                    const incorrectFeedbackText = currentDifficulty === 'easy' ? "Not quite." : "That's incorrect.";
                    // Store both versions in data attributes
                    feedbackDiv.innerHTML = `<span class="translatable-segment" data-easy="Not quite." data-challenge="That's incorrect.">${incorrectFeedbackText}</span>`;
                    addFeedbackButtons(feedbackDiv); // Add TTS/Translate to feedback
                    feedbackDiv.style.display = 'inline-flex'; // Show feedback area
                 }
                 // Highlight the correct answer visually
                 quizBlock.querySelector('.option-group[data-correct="true"] .quiz-option-button')?.classList.add('correct');
                 perfectRun = false; // --- Set perfect run to false on incorrect answer ---
             }


             // Check if all VISIBLE quizzes in the *current section* are now complete
             const currentSectionElement = sections[currentSectionIndex];
             let sectionIsComplete = true; // Assume complete initially
             let visibleQuizCountInSection = 0;

             if (currentSectionElement) {
                 const quizContainer = currentSectionElement.querySelector('.quiz-container');
                 if (quizContainer) {
                     currentSectionElement.querySelectorAll('.quiz-block').forEach(block => {
                         // Check if block is visible (using style set in initLesson)
                         if (block.style.display !== 'none') {
                            // Check if block has visible options
                            let blockHasVisibleOptions = false;
                            block.querySelectorAll('.option-group').forEach(optGroup => {
                                if (optGroup.style.display !== 'none') {
                                    blockHasVisibleOptions = true;
                                }
                            });

                            // If the block is visible and has visible options, it counts towards completion check
                            if (blockHasVisibleOptions) {
                                visibleQuizCountInSection++;
                                // If this visible block hasn't been answered yet, the section is not complete
                                if (!block.classList.contains('answered')) {
                                    sectionIsComplete = false;
                                }
                            }
                         }
                     });
                 } else {
                      // No quiz container in this section, so it's considered complete
                     sectionIsComplete = true;
                 }
             }

             // If there were no visible quizzes, the section is complete by default
             if (visibleQuizCountInSection === 0) {
                 sectionIsComplete = true;
             }

             // Update the state and Next button based on whether the section is now complete
             quizStates[currentSectionIndex] = sectionIsComplete;
             updateNavigation(); // Update nav buttons based on the new state
         }


        //------------------------------------//
        //  Gamification                     //
        //------------------------------------//
        function triggerPlusOne(targetElement) {
             const button = targetElement.closest('.quiz-option-button') || targetElement;
             // Ensure the button can be a reference for absolute positioning
             if (window.getComputedStyle(button).position === 'static') {
                button.style.position = 'relative';
             }
            const plusOne = document.createElement('span');
            plusOne.textContent = '+1';
            plusOne.className = 'plus-one-effect';
             button.appendChild(plusOne);
            // Remove the element after the animation finishes
            plusOne.addEventListener('animationend', () => plusOne.remove());
        }

        //------------------------------------//
        //  High Score Logic                //
        //------------------------------------//

        /**
         * Loads high scores from localStorage.
         * @returns {Array} Array of high score objects.
         */
        function loadHighScores() {
            try {
                const scoresJSON = localStorage.getItem(HIGH_SCORE_KEY);
                return scoresJSON ? JSON.parse(scoresJSON) : [];
            } catch (e) {
                console.error("Error loading high scores:", e);
                return []; // Return empty array on error
            }
        }

        /**
         * Saves a new high score, keeps the list sorted and trimmed.
         * @param {string} name Player's name.
         * @param {number} score Player's score.
         * @param {boolean} perfect Whether the run was perfect.
         */
        function saveHighScore(name, score, perfect) {
            try {
                const highScores = loadHighScores();
                const newScore = {
                    name: sanitizeHTML(name), // Sanitize name before saving
                    score: score,
                    perfect: perfect,
                    date: new Date().toISOString() // Record the date
                };

                highScores.push(newScore);
                highScores.sort((a, b) => b.score - a.score); // Sort descending by score
                const trimmedScores = highScores.slice(0, MAX_HIGH_SCORES); // Keep only top N scores

                localStorage.setItem(HIGH_SCORE_KEY, JSON.stringify(trimmedScores));
                console.log("High score saved:", newScore);
                 // Display immediately after saving (will be called before showing results page)
                 // displayHighScores(); // Removed: Called explicitly in showSection for results page
            } catch (e) {
                console.error("Error saving high score:", e);
            }
        }

        /**
         * Displays the high scores in the #high-score-list element.
         */
        function displayHighScores() {
            const highScoreList = document.getElementById('high-score-list');
            if (!highScoreList) return; // Exit if element not found

            const highScores = loadHighScores();
            highScoreList.innerHTML = ''; // Clear current list

            if (highScores.length === 0) {
                highScoreList.innerHTML = '<li class="no-scores">No high scores recorded yet. Be the first!</li>';
            } else {
                highScores.forEach((scoreData, index) => {
                    const li = document.createElement('li');
                    const emoji = scoreData.perfect ? '👑' : '⭐'; // Crown for perfect, star otherwise
                    // Use spans for easier styling and accessibility
                    li.innerHTML = `
                        <span class="rank">${index + 1}.</span>
                        <span class="emoji" aria-hidden="true">${emoji}</span>
                        <span class="name">${sanitizeHTML(scoreData.name)}</span>
                        <span class="score">${scoreData.score} pts</span>
                    `;
                    highScoreList.appendChild(li);
                });
            }
        }

        //------------------------------------//
        //  ELL Scaffolding: Translation     //
        //------------------------------------//

         // --- Double-click Translation ---
         document.getElementById('lesson-container').addEventListener('dblclick', (event) => {
             let segment = null;
             let clickedElement = event.target;

             // Traverse up to find the segment, but stop if we hit the container or go too deep
             for (let i = 0; i < 3 && clickedElement && clickedElement.id !== 'lesson-container'; i++) {
                 if (clickedElement.classList && clickedElement.classList.contains('translatable-segment')) {
                     segment = clickedElement;
                     break;
                 }
                 clickedElement = clickedElement.parentElement;
             }

             if (segment) {
                 // Use setTimeout to allow the selection to register after dblclick
                 setTimeout(() => {
                     const selection = window.getSelection();
                     const selectedText = selection.toString().trim();
                     // Only translate if actual text is selected within the segment
                     if (selectedText && selectedText.length > 0) {
                         if (selection.rangeCount > 0) {
                             const range = selection.getRangeAt(0);
                             // Ensure the selection is actually within the boundaries of the segment element
                             if (segment.contains(range.commonAncestorContainer)) {
                                 translateWord(selectedText);
                             }
                         }
                     }
                 }, 50); // Small delay
             }
         });

        function translateWord(word) {
            if (!word) return;
            console.log(`Opening Google Translate for: "${word}"`);
            const url = `https://translate.google.com/?sl=en&tl=th&text=${encodeURIComponent(word)}&op=translate`;
            // Try to reuse the same window/tab
            window.open(url, TRANSLATE_WINDOW_NAME, 'noopener,noreferrer');
        }

        // --- Segment Translation (Button Click) ---
        function translateSegment(buttonOrContainer) {
             const segment = findAssociatedSegment(buttonOrContainer);
             if (segment) {
                 let textToTranslate = getTextForSpeech(segment); // Use cleaned text
                 if (!textToTranslate) {
                     console.warn("No text found in segment to translate:", segment);
                     return;
                 };
                  console.log(`Opening Google Translate for segment: "${textToTranslate.substring(0, 50)}..."`);
                  const url = `https://translate.google.com/?sl=en&tl=th&text=${encodeURIComponent(textToTranslate)}&op=translate`;
                 window.open(url, TRANSLATE_WINDOW_NAME, 'noopener,noreferrer');
             } else {
                 console.warn("Could not find segment to translate for button:", buttonOrContainer);
             }
        }


        //------------------------------------//
        //  ELL Scaffolding: Text-to-Speech  //
        //------------------------------------//
        function speakText(buttonOrContainer) {
            stopSpeech(); // Stop previous speech first

            const segmentElement = findAssociatedSegment(buttonOrContainer);

             if (!segmentElement) {
                 console.warn("No text element found to speak for button:", buttonOrContainer);
                 return;
             }

            const textToSpeak = getTextForSpeech(segmentElement); // Get cleaned text

            if (!textToSpeak) {
                 console.warn("No speakable text content found in segment:", segmentElement);
                return;
            }

             targetSegmentForHighlighting = segmentElement; // Store segment for highlighting

            currentUtterance = new SpeechSynthesisUtterance(textToSpeak);
            currentUtterance.lang = 'en-US'; // Set language
            currentUtterance.rate = parseFloat(ttsSpeedSlider.value); // Set speed

            // --- Highlighting (Segment Level) ---
            currentUtterance.onstart = () => {
                 if (targetSegmentForHighlighting && !targetSegmentForHighlighting.classList.contains('highlight')) {
                    clearHighlighting(); // Clear previous just in case
                    targetSegmentForHighlighting.classList.add('highlight');
                 }
            };

            // --- Boundary event (Optional - can be resource intensive) ---
             /* // Removed word-level highlighting for simplicity/performance
             currentUtterance.onboundary = (event) => {
                  if (event.name === 'word' && targetSegmentForHighlighting) {
                      // Implement word-level highlighting if needed - complex
                  }
             };
             */

            currentUtterance.onend = () => {
                 clearHighlighting(); // Remove highlight when done
                 currentUtterance = null;
                 targetSegmentForHighlighting = null;
            };

            currentUtterance.onerror = (event) => {
                 console.error('Speech synthesis error:', event.error, 'Utterance:', textToSpeak.substring(0, 50) + "...");
                  if (event.error === 'interrupted') console.log("Speech interrupted.");
                  else if (event.error === 'canceled') console.log("Speech canceled.");
                 clearHighlighting(); // Clear highlight on error
                 currentUtterance = null;
                 targetSegmentForHighlighting = null;
            };

            // Add a tiny delay before speaking, helps prevent issues on some browsers
             setTimeout(() => {
                 if (synth && currentUtterance) {
                    synth.speak(currentUtterance);
                 }
             }, 50);

        }

        function stopSpeech() {
            if (synth?.speaking) {
                synth.cancel(); // Cancels the current utterance queue
            }
             clearHighlighting(); // Always clear highlight on stop
             currentUtterance = null; // Reset utterance variable
             targetSegmentForHighlighting = null; // Reset highlight target
        }

        function clearHighlighting() {
             // Remove 'highlight' class from any element that might have it
             document.querySelectorAll('.translatable-segment.highlight').forEach(el => el.classList.remove('highlight'));
             // Note: We don't need highlightedWordSpan anymore if doing segment-level highlighting
        }

        stopTtsButton.addEventListener('click', stopSpeech);

         ttsSpeedSlider.addEventListener('input', () => {
             // If speech is active while changing speed, stop it. User needs to click again.
             if (synth.speaking && currentUtterance) {
                 console.log("Speed changed during speech. Stopping. Click read again to use new speed.");
                 stopSpeech();
             }
         });

         // Ensure speech stops if the page is closed/navigated away
         window.addEventListener('beforeunload', stopSpeech);

        //------------------------------------//
        //  Initial Page Setup               //
        //------------------------------------//
        document.addEventListener('DOMContentLoaded', () => {
            // Don't initLesson yet, wait for difficulty choice
            showSection(0); // Show welcome section (index 0) initially
            // High scores are loaded/displayed only when the results section (12) is shown.
        });

    </script>

</body>
</html>